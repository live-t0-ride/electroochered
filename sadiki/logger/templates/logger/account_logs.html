{% extends "account/account_base.html" %}

{% block content_title %}
    <h1>{% block title %}История изменений{% endblock %}</h1>
{% endblock %}

{% block content %}
    {% for requestion, logs_with_messages in  requestions_with_logs %}
        <h2>Заявка {{ requestion }}</h2>
        {% include "logger/include/include_logs.html" %}
    {% endfor %}
    {% if pdata_logs %}
        <h2>Изменения персональных данных</h2>
        <table class="table table-striped table-bordered table-condensed">
            <thead>
                <tr>
                    <td>Дата изменения</td>
                    <td>Тип изменения</td>
                    <td>Изменения</td>
                    <td>Пользователь</td>
                    <td>Основание</td>
                </tr>
            </thead>
            <tbody>
            {% with requset.user.is_administrative_person as administrative_user %}
                {% for log in pdata_logs %}
                    <tr>
                        <td>{{ log.datetime }}</td>
                        <td>{{ log.get_action_flag_display }}</td>
                        <td>---
                        </td>
                        <td>
                            {% comment %}
                            имя пользователя показываем для администраторов
                            либо если изменения делал администратор(публичная персона)
                            либо если изменение сделал сам пользователь
                            {% endcomment %}
                            {% if administrative_user or log.user.is_administrative_person or log.user == request.user%}
                                {{ log.user.get_verbose_name }}
                            {% endif %}
                        </td>
                        <td>{{ log.reason|default:"Не указано" }}</td>
                    </tr>
                {% endfor %}
            {% endwith %}
            </tbody>
        </table>
    {% endif %}
{% endblock %}