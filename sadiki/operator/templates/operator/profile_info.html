{% extends "account/frontpage.html" %}
{% load sadiki_core_tags %}

{% block content_menu %}
    {% include "operator/includes/requestion_menu.html" %}
{% endblock %}

{% block title %}
    Информация о профиле {{ profile }}
{% endblock %}

{% block bottomjs %}
    {{ block.super }}
    {# диалоговое окно сброса пароля #}
    <script type="text/javascript">
        $(document).ready(function(){
            $("#reset_password_btn").each(function(){
                $(this).click(function() {
                    $( "#dialog-confirm" ).dialog({
                      resizable: false,
                      height:200,
                      modal: true,
                      buttons: {
                        "Да": function() {
                            $("#reset_password_form").submit();
                            $( this ).dialog( "close" );
                        },
                        "Нет": function() {
                          $( this ).dialog( "close" );
                        }
                      }
                    });
                    return false;
                });
            });
        });
    </script>
{% endblock %}

{% block content %}
    <div class="notification-area">
        {% if profile.get_profile.requestion_set.not_confirmed.exists %}
            <div class="alert alert-error">Вам необходимо в ближайшее время подтвердить заявки, обратившись в управление образования.</div>
        {% endif %}
    </div>
    <div class="row">
    <div class="span6">
        <div class="requestion-info">
            <label class="field-label">Имя пользователя:</label>
            <p class="field-value">{{ profile.user.username }}</p>
            {# сброс пароля #}
            <label class="field-label">Пароль:</label>
            <p class="field-value">
                {% if profile.user.has_usable_password %}
                    <img title="Пароль задан" src="{{ STATIC_URL }}img/icon_approved.fw.png"/>
                    <span class="value">Пароль задан</span>
                {% else %}
                    <img title="Пароль не задан" src="{{ STATIC_URL }}img/icon_not_approved.fw.png"/>
                    <span class="value">Пароль не задан</span>
                {% endif %}
                <form id="reset_password_form" action="{% url generate_profile_password profile_id=profile.id %}" method="post" target="_blank">{% csrf_token %}
                    {{ reset_password_form.as_ul }}
                </form>
                <button id="reset_password_btn" class="btn">Сгенерировать новый пароль</button>
            </p>
            <div id="dialog-confirm" class="confirmation-dialog" title="Сбросить пароль?">
              <p><span class="ui-icon ui-icon-alert" style="float: left; margin: 0 7px 20px 0;"></span>Внимание! Вход будет возможен только по новому паролю.</p>
            </div>

        {% block profile_additions %}
            {{ block.super }}
        {% endblock %}
        </div>
    </div>
    <div class="span5">
        <div class="requestion-info">
            <div class="block-head">Заявки профиля:</div>
            {% for requestion in profile.requestion_set.all|dictsort:"id" %}
                <div class="requestion-block {% cycle "white" "gray" %}">
                <label class="field-label">№ заявки:</label>
                {% url operator_requestion_info requestion_id=requestion.id as requestion_url %}
                <p class="field-value"><a href="{{ requestion_url }}">{{ requestion.requestion_number }}</a></p>
                <label class="field-label">Имя:</label>
                <p class="field-value">{{ requestion.name }}</p>
                <label class="field-label">Дата рождения:</label>
                <p class="field-value">{{ requestion.birth_date }}</p>
                <label class="field-label">Статус:</label>
                {% if requestion.document_confirmed %}
                    <p class="field-value">{{ requestion.get_status_display }}</p>
                {% else %}
                    <p class="field-value">
                        <img src="{{ STATIC_URL }}img/icon_not_approved.fw.png"/>
                        {{ requestion.get_status_display }}
                        <span class="status-not-approved">Статус не подтвержден оператором</span>
                    </p>
                {% endif %}
                <label class="field-label">Порядковый номер в очереди:</label>
                <p class="field-value">{{ requestion.position_in_queue }}</p>
                </div>
            {% endfor %}
            {% url operator_requestion_add profile_id=profile.id as requestion_add_url %}
            <a class="link-with-image requestion-add action-link" href="{{ requestion_add_url }}">
                <img src="{{ STATIC_URL }}img/icon_add.fw.png"/>
                Добавить заявку
            </a>
        </div>
    </div>
    </div>
{% endblock %}